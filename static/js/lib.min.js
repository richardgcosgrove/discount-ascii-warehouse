"use strict";function generateAdId(){return Math.floor(1e4*Math.random())}function getAd(){for(var t=generateAdId();lastAdId===t;)t=generateAdId();return lastAdId=t,t}function addAd(t){lastAd=!0,++adCount,$(".products").append('<div class="product container" style="">\n        <img class="product__ad" src="/ad/?r='+getAd()+'"/>\n    </div>'),pending.unshift(t)}function addAdOrProduct(t){var n=t;return products.indexOf(t)===-1&&(++itemsLength,lastAd||(itemsLength-1)%20!==0?addProduct(n):addAd(n),!0)}function addProduct(t){lastAd=!1;var n=new Date(t.date),e=Date.now()-n.getTime();n=e>6048e5?pad(n.getMonth(),2)+"/"+pad(n.getDate(),2)+"/"+pad(n.getFullYear(),4):Math.floor(e/864e5)+" days ago",$(".products").append('<div class="product container">\n            <div class="product__face" style="font-size: '+t.size+'px" >'+t.face+'</div>\n            <div class="product__size" >size: '+t.size+'px</div>\n            <div class="product__price">price: $'+(.01*t.price).toFixed(2)+'</div>\n            <div class="product__date">date: '+n+"</div>\n        </div>"),products.push(t)}function addRows(){var t=arguments.length<=0||void 0===arguments[0]?2:arguments[0];pending.length>0&&!function(){var n=getCol(),e=itemsLength%n,d=n*t-e,i=0,o=pending.slice(0,d);o.map(function(t){if(i<d&&addAdOrProduct(t)){if(pending.shift(),++i>d)return;if(lastAd&&addAdOrProduct(t)&&(pending.shift(),++i>d))return}})}()}function changeSort(t){sort=t,load()}function debounce(t,n,e){var d;return function(){var i=this,o=arguments,r=function(){d=null,e||t.apply(i,o)},c=e&&!d;clearTimeout(d),d=setTimeout(r,n),c&&t.apply(i,o)}}function getCol(){document;return Math.ceil($("body").width()/(productWidth+20))}function getDocHeight(){var t=document;return Math.max(t.body.scrollHeight,t.documentElement.scrollHeight,t.body.offsetHeight,t.documentElement.offsetHeight,t.body.clientHeight,t.documentElement.clientHeight)}function load(){adCount=1,lastAd=!0,pending=[],products=[],pending=[],pendingAction=null,itemsLength=0,$(".products").empty(),$(".endOfTheLine").hide(),$(".products").hide(),$(".loading").slideDown("1000");for(var t=getDocHeight(),n=$("body").height(),e=0,d=productHeight+50;d+n<t;d+=productHeight+50)++e;pendRows(e+8).then(function(){$(".loading").slideUp(500,function(){addRows(e),$(".products").fadeIn(1500),$(".endOfTheLine").show()})})}function pad(t,n,e){return e=e||"0",t+="",t.length>=n?t:new Array(n-t.length+1).join(e)+t}function pendRows(){var t=arguments.length<=0||void 0===arguments[0]?1:arguments[0],n=getCol()*t;if(!(n<0||pendingAction)){var e=$.get("/api/products?limit="+n+("&skip="+itemsLength)+(""!==sort?"&sort="+sort:""),function(t){try{if(!t||t.length<0)return;var n="[".concat(t.replace(/\n/g,","));n=n.substr(0,n.length-1),n=n.concat("]"),n=JSON.parse(n),$.each(n,function(t,n){pending.push(n)})}catch(n){console.log(n),console.log(t)}},"text");return e.then(function(){pendingAction=null}),pendingAction=e,e}}var lastAdId=null,adCount=0,itemsLength=0,lastAd=!0,pending=[],pendingAction=void 0,pendingQeueMax=1e3,products=[],productHeight=200,productWidth=470,sort="";